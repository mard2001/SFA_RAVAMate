<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Fake GPS Tagging</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.18/datatables.min.css"/>
    <link rel="shortcut icon" href="/img/mdlogo_web.png" type="image/png">
</head>
<style>
    @import "https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700";
    body {
        font-family: 'Poppins', sans-serif !important;
        font-size: 14px !important;
    }
</style>
<body>

    <div class="container" style="margin-top: 20px;">

        <ul class="nav nav-tabs justify-content-center" id="myTab" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">New Detection</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Blocklisted</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Whitelisted</a>
            </li>
          </ul>
          <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab" style="width:100% !important;">
                <br>
                <table id="" class="table table-hover table-striped newdetection display no-wrap" style="width:100% !important;">
                    <thead class="thead-dark">
                        <tr>
                            <th>Package Name</th>
                            <th>Application Label</th>
                            <th>Md Code</th>
                            <th>Date Detected</th>
                            <th>Date Inserted</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab" style="width:100% !important;">
                <br>
                <table id="" class="table table-hover blocklisted" style="width:100% !important;">
                    <thead class="thead-dark">
                        <tr>
                            <th>Package Name</th>
                            <th>Application Label</th>
                            <th>Md Code</th>
                            <th>Date Detected</th>
                            <th>Date Inserted</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab" style="width:100% !important;">
                <br>
                <table id="patchList" class="table table-hover  whitelisted" style="width:100% !important;">
                    <thead class="thead-dark">
                        <tr>
                            <th>Package Name</th>
                            <th>Application Label</th>
                            <th>Md Code</th>
                            <th>Date Detected</th>
                            <th>Date Inserted</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
          </div>


       
      
    </div>

    <div class="modal fade" id="newPatchModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="dynamicHeader"><i class="fas fa-server"></i> NEW PATCH</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="formGroupExampleInput">Patch Note</label>
                    <input type="text" class="form-control" id="plNotesH" placeholder="">
                </div>
                <div class="form-group">
                    <label for="formGroupExampleInput">Query</label>
                    <textarea id="plQueryH" class="form-control"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="insertPatch()">Insert</button>
            </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="updatePatchModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dynamicHeader"><i class="fas fa-server"></i> UPDATE FAKE GPS ENTRY</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <table class="table table-striped">
                        <tr>
                            <td><strong>Package Name</strong></td>
                            <td id="packageName"></td>
                        </tr>
                        <tr>
                            <td><strong>Application Label</strong></td>
                            <td id="appLabel"></td>
                        </tr>
                        <tr>
                            <td><strong>MdCode</strong></td>
                            <td id="mdCode">
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Date Detected</strong></td>
                            <td id="dateDetected">
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Date Inserted</strong></td>
                            <td id="dateInserted"></td>
                        </tr>
                        <tr>
                            <td><strong>Action</strong></td>
                            <td>
                                <select class="form-control" id="isallowedStat">
                                    <option value="YES" class="text-success">Whitelisted</option>
                                    <option value="NO" class="text-danger">Blocklisted</option>
                                    <option value="" class="text-success">For Investigation</option>
                                </select>
                            </td>
                        </tr>
                    </table>
                    <input type="hidden" id="fakegpsCID"></input>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning" onclick="updatePatch()">Update</button>
                    <!-- <button type="button" class="btn btn-danger" onclick="deletePatch()"><i class="fas fa-trash"></i> Remove</button> -->
                </div>
                </div>
            </div>
        </div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.18/datatables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/responsive.bootstrap4.min.js"></script> 
    <!-- <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.3.1/js/dataTables.buttons.min.js"></script> -->
    <!-- <script type="text/javascript" src="js/notfunction.js"></script> -->
    <!-- <script type="text/javascript" src="/js/scrolling.js"></script> -->
    <script type="text/javascript">

    var GLOBALLINKAPI = 'https://fast-onesolutions.com/BUDDYGBLAPI/';

    var tableData, tableData2, tableData3, newdetection_source, blocklisted_source, whitelisted_source;
    function updatePatch(){
        var cID = $('#fakegpsCID').val(); 
        var isAllowedStat = $('#isallowedStat').val();

        if(isAllowedStat == undefined){
            alert('Please select a status.');
        }else{
            var f = confirm('Are you sure you want to update this entry?');
            if(f){
                $.ajax ({
                    url: GLOBALLINKAPI+"/admin/connection/applicationApi.php",
                    type: "post",
                    data: {
                        "type":"UPDATE_FAKE_GPS_ENTRY",
                        "cID":cID,
                        "isAllowedStat":isAllowedStat,
                    },
                    dataType: "json",
                    crossDomain: true,
                    cache: false,  
                    async: false,          
                    success: function(r){
                        if(r){
                            newdetection();
                            tableData.clear().rows.add(newdetection_source).draw();

                            blocklisted();
                            tableData2.clear().rows.add(blocklisted_source).draw();

                            whitelisted();
                            tableData3.clear().rows.add(whitelisted_source).draw();

                            tableData.columns.adjust().draw(); 
                            tableData2.columns.adjust().draw(); 
                            tableData3.columns.adjust().draw(); 

                            alert('Entry successfully updated!');
                            $('#updatePatchModal').modal('hide');
                        }
                    }
                });
            }
        }

      
    }

    function deletePatch(){
        var f = confirm('Are you sure you want to delete this patch?');
        if(f){
            var patchID = $('#patchIdUpdateHolder').val(); 
            $.ajax ({
                url: GLOBALLINKAPI+"/admin/connection/applicationApi.php",
                type: "GET",
                data: {
                    "type":"DELETE_PATCH",
                    "patchID":patchID
                },
                dataType: "json",
                crossDomain: true,
                cache: false,  
                async: false,          
                success: function(r){
                    if(r){
                        newdetection();
                        tableData.clear().rows.add(newdetection_source).draw();
                        alert('Patch successfully deleted!');
                        $('textarea#plQueryH').val('');
                        $('#plNotesH').val('');
                        $('#updatePatchModal').modal('hide');
                    }
                }
            });
        }
    }

    function insertPatch(){
        var query = $('textarea#plQueryH').val();
        var notes = $('#plNotesH').val();
        if(query == '' || notes == ''){
            alert('Empty fields are not accepted!');
        }else{
            $.ajax ({
                url: GLOBALLINKAPI+"/admin/connection/applicationApi.php",
                type: "POST",
                data: {
                    "type":"INSERT_PATCH",
                    "notes":notes,
                    "query":query
                },
                dataType: "json",
                crossDomain: true,
                cache: false,  
                async: false,          
                success: function(r){
                    if(r){
                        newdetection();
                        tableData.clear().rows.add(newdetection_source).draw();
                        alert('Patch successfully inserted!');
                        $('textarea#plQueryH').val('');
                        $('#plNotesH').val('');
                        $('#newPatchModal').modal('hide');
                    }
                }
            });
        }
    } 
     
   

    
    newdetection();
    whitelisted();
    blocklisted();
    patchListTable();
    function patchListTable(){
        tableData = $('table.newdetection').DataTable({
            "dom": 'Bfrtip',
            "responsive": true,
            "data": newdetection_source,
            "scrollX": '100%',
            "ordering": true,
            "pageLength": 10,
            columns: [
                { data: "PackageName"},
                { data: "ApplicationLabel"},
                { data: "mdCode" },
                { data: "dateDetected" },
                { data: "dateInserted" },
                { data: "isAllowed" }
            ],
           
            rowCallback: function(row, data, index){
                // if(data.PLStatus.toString() == '0'){
                //     $(row).find('td:eq(2)').css({'color':'green', 'letter-spacing':'3px', 'font-size':'12px'});
                //     $(row).find('td:eq(2)').text('enabled');
                // }else{
                //     $(row).find('td:eq(2)').css({'color':'red', 'letter-spacing':'3px', 'font-size':'12px'});
                //     $(row).find('td:eq(2)').text('disabled');
                // }

                $(row).find('td:eq(5)').css({'color':'blue'});
                $(row).find('td:eq(5)').text('For Investigation');
            },
        });
          
	    $('table.newdetection tbody').on('click', 'tr', function () {
            var tr = $(this).closest('tr');
            var row = tableData.row(tr);
            //showsvr(row.data());
            setPatchdata_update(row.data());
        });


        tableData2 = $('table.blocklisted').DataTable({
            "dom": 'Bfrtip',
            "responsive": true,
            "data": blocklisted_source,
            "scrollX": '100%',
            "ordering": true,
            "pageLength": 10,
            columns: [
                { data: "PackageName"},
                { data: "ApplicationLabel"},
                { data: "mdCode" },
                { data: "dateDetected" },
                { data: "dateInserted" },
                { data: "isAllowed" }
            ],
           
            rowCallback: function(row, data, index){
                // if(data.PLStatus.toString() == '0'){
                //     $(row).find('td:eq(2)').css({'color':'green', 'letter-spacing':'3px', 'font-size':'12px'});
                //     $(row).find('td:eq(2)').text('enabled');
                // }else{
                //     $(row).find('td:eq(2)').css({'color':'red', 'letter-spacing':'3px', 'font-size':'12px'});
                //     $(row).find('td:eq(2)').text('disabled');
                // }

                $(row).find('td:eq(5)').css({'color':'red'});
                $(row).find('td:eq(5)').text('BLOCKLISTED');
            },
        });
          
	    $('table.blocklisted tbody').on('click', 'tr', function () {
            var tr = $(this).closest('tr');
            var row = tableData2.row(tr);
            //showsvr(row.data());
            setPatchdata_update(row.data());
        });


        tableData3 = $('table.whitelisted').DataTable({
            "dom": 'Bfrtip',
            "responsive": true,
            "data": whitelisted_source,
            "scrollX": '100%',
            "ordering": true,
            "pageLength": 10,
            columns: [
                { data: "PackageName"},
                { data: "ApplicationLabel"},
                { data: "mdCode" },
                { data: "dateDetected" },
                { data: "dateInserted" },
                { data: "isAllowed" }
            ],
           
            rowCallback: function(row, data, index){
                $(row).find('td:eq(5)').css({'color':'green'});
                $(row).find('td:eq(5)').text('WHITELISTED');
            },
        });
          
	    $('table.whitelisted tbody').on('click', 'tr', function () {
            var tr = $(this).closest('tr');
            var row = tableData3.row(tr);
            //showsvr(row.data());
            setPatchdata_update(row.data());
        });
        
        function setPatchdata_update(r){
           

            $('#packageName').html(r.PackageName);
            $('#appLabel').html(r.ApplicationLabel);
            $('#mdCode').html(r.mdCode);
            $('#dateDetected').html(r.dateDetected);
            $('#dateInserted').html(r.dateInserted);
            $('#isallowedStat').val(r.isAllowed);

            $('#fakegpsCID').val(r.cID);

            $('#updatePatchModal').modal('show');
               
        }

    }


    function newdetection(){
        $.ajax ({
        url: GLOBALLINKAPI+"/admin/connection/applicationApi.php",
        type: "GET",
        data: {
            "type":"GET_FAKEGPSLISTING",
            'stat':'newdectection'
          },
        dataType: "json",
        crossDomain: true,
        cache: false,  
        async: false,          
        success: function(r){
            newdetection_source = r;


          
        }
      });   
    } 

    function blocklisted(){
        $.ajax ({
        url: GLOBALLINKAPI+"/admin/connection/applicationApi.php",
        type: "GET",
        data: {
            "type":"GET_FAKEGPSLISTING",
            'stat':'blocklisted'
          },
        dataType: "json",
        crossDomain: true,
        cache: false,  
        async: false,          
        success: function(r){
            blocklisted_source = r;

            $('.newdetection').css('width','100% !important');
            $('.blocklisted').css('width','100% !important');
            $('.whitelisted').css('width','100% !important');


            tableData.columns.adjust().draw();
            tableData2.columns.adjust().draw(); 
            tableData3.columns.adjust().draw(); 
        }
      });   
    } 

    function whitelisted(){
        $.ajax ({
        url: GLOBALLINKAPI+"/admin/connection/applicationApi.php",
        type: "GET",
        data: {
            "type":"GET_FAKEGPSLISTING",
            'stat':'whitelisted'
          },
        dataType: "json",
        crossDomain: true,
        cache: false,  
        async: false,          
        success: function(r){
            whitelisted_source = r;
        }
      });   
    } 


          


          

    </script>
</body>
</html>
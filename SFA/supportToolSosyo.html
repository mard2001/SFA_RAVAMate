
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Sosyo Support</title>
    <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>   
    <link rel="stylesheet" href="/js/bootstrap-multiselect-master/dist/css/bootstrap-multiselect.css" type="text/css"/>
    <script type="text/javascript" src="/js/bootstrap-multiselect-master/dist/js/bootstrap-multiselect.js"></script>   
    <link rel="shortcut icon" href="/img/mdlogo_web.png" type="image/png">
    <script type="text/javascript" src="//cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css">
    <link rel="stylesheet" href="/css/mdDesign.css">

    <!-- datatables -->
    <link href="https://cdn.datatables.net/v/bs5/dt-2.1.0/datatables.min.css" rel="stylesheet">

    <style>
      .storemarkerImage{
        height: 150px;
        width: 150px;
        /* border-radius: 90%; */
      }

      .container_salesman{
        border-radius: 5px;
      }

      .container_salesman.step_1{
        padding: 10px;
      }

      .page-link{
        background-color: #1c9ec5;
        border: 2px solid #1c9ec5;
        margin: 0 1px;
      }

      .useBtn{
        padding: 3px 10px;
      }

      .arrow-side-icon{
        margin-top: 325px;
      }

      #vehicleListData tr:hover{
        cursor: pointer;
        background-color: #6a8cb8;
      }
    </style>

</head>

<body class="" id="page-top" onload="init()">
  <!-- Navigation-->
    <div id="mySidenav" class="sidenav">
        <div class='image'>
            <img alt='mdbuddylogo' class='logoMd' src='/img/mdbuddylogo_jeff.png'/>
        </div>
        <a href="https://mybuddy-sfa.com/SFA/Dashboard"> <span class='glyphicon glyphicon-home'></span> Dashboard</a>
        <a href="https://mybuddy-sfa.com/SFA/digitalMapping"> <span class='glyphicon glyphicon-map-marker'></span> Digital Mapping</a>
        <a href="https://mybuddy-sfa.com/SFA/customerMapping"> <span class="fa fa-users" aria-hidden="true"></span> Customer Mapping</a>
        <a href="territoryGeofencing"> <span class='glyphicon glyphicon-cog'></span> Territory Geofencing</a>
        <a data-toggle="collapse" href="#collapse1" id='navDrop'> <span class='glyphicon glyphicon-duplicate' id='changeIcon'></span> Reports
        <i class="glyphicon glyphicon-menu-down pull-right"></i> </a>
            <div id="collapse1" class="panel-collapse collapse" style="margin-left: 17px; font-size: 9px !important">
                <a href="salesReport"> Sales Report</a>
                <a href="fastsosyotransaction"> Fastsosyo Transaction</a>
                <a href="salesAudit"> Sales Audit</a>
                <a href="transactionLedger"> Transaction Ledger</a>
                <a href="UnprocessedOrders"> Unprocessed Orders</a>
                <a href="dsr"> DSR</a>
                <a href="dcr"> Daily Collection</a>
                <a href="stockRequest"> Stock Request</a>
                <a href="unuploaded"> Unuploaded</a>
                <a href="BOReport"> BO</a>
                <a href="Stocktake Report"> Stocktake</a>
                <a href="inventory"> Inventory Valuation</a>
                <a href="jobberMaintenance"> Jobber</a>
                <a href="syncreport">Sync Report</a>
                <a href="soaprvreport">SO Approval</a>
            </div>
        <a data-toggle="collapse" href="#collapse2" id='navDrop' class="maintenanceCont"> <span class="fa fa-cogs" aria-hidden="true" id='changeIcon'></span> Maintenance
        <i class="glyphicon glyphicon-menu-down pull-right"></i> </a>
            <div id="collapse2" class="panel-collapse collapse" style="margin-left: 17px; font-size: 9px !important">
                <a href="dataMaintenance"> Data</a>
                <a href="customer"> Customer</a>
                <a href="cmf">CMF</a>
                <a href="geoReset"> Georeset</a>
                <a href="salesman"> Salesman</a>
                <a href="product"> Product</a>
                <a href="productbtdt"> BTDT Product</a>
                <a href="customerTagging"> Tagging</a>
                <a href="bankmaintenance"> Bank</a>
                <a href="mcpcalibration" class="activeYes">MCP Calibration</a>
            </div>
        <!-- <a href="Alert"> <span class='glyphicon glyphicon-envelope'></span> Alert Messages</a> -->
        <!--div class='hideNav'>
            <a href="#" class="btn btn-primary" onclick='closeNav()' style='position: absolute; bottom: 0; width:100%;'>
                <span class='glyphicon glyphicon-menu-left' style='color:white;'></span>
            </a>
        </div>-->
    </div>

    <div id="main">
        <h4 class="display-4 dispMargin">
            <!-- <a href="#" id='navBtn' class="btn btn-primary"  style='margin-right: 15px;'>
            <span class="glyphicon glyphicon-menu-hamburger"></span> 
            </a> -->
            <span class="fa fa-user" aria-hidden="true"></span> Sosyo Support Tool
            <span class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a style='float:right;' href="#" class="dropdown-toggle" data-toggle="dropdown" id='dropThisDown'>
                        <span class="label label-pill label-danger count" style='border-radius: 10px; font-size: 10px;'></span>
                        <span class="fa fa-bell"></span>
                    </a>
                            
                    <ul class="dropdown-menu" style='padding: 0'>
                        <div class="scroll" data-simplebar>
                            <div id='notifs-icon-div'></div>
                        </div>
                        <a type="button" class="btn btn-default btn-block" href='mdAlert_bohol.php' id='seeAll' >See all</a>
                    </ul>
                </li>

                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user-circle-o"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li>
                            <a href="Profile.html"><i class="fa fa-user-circle-o"></i> My Account</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#" id="admin-logout-btn"><i class="fa fa-sign-out fa-fw"></i>Logout</a>
                        </li>
                    </ul>
                </li>
            </span>
        </h4>
        <div class="panel cust-panel">
            <div class="panel-heading">
                <i class='fa fa-map-o'></i> <span id="headingTitle"></span>
            </div>
            <button class='btn btn-default btn-xs sideBtn' style="width: 33px; margin-top: 20px;" data-toggle="tooltip" data-placement="left" title="restore map view" id='restorBtn' onclick='restoreLoc()'><i class="fa fa-map-pin" aria-hidden="true"></i></button>

            <div id="map"></div>


            <div class="outerContMain" id='outerContainer_id' style="width: 500px !important;"> 

            <!-- <span class="pull-left" style="padding: 10px;"><button onclick="createterremodal()" class="btn btn-xs" style="background-color: #333; color: white;">CREATE TERRITORY</button></span> -->
            <!-- <div class="loading-table">
                <i class="fa fa-spinner fa-spin fa-3x fa-fw message"></i> Preparing salesman list ..
                <span class="sr-only">Loading...</span>
            </div> -->

            <div id='salesmanCategory'>
                <div class="arrow-side"><i onclick="flip1()" class="fa fa-angle-left arrow-side-icon" aria-hidden="true"></i></div> 
                <div style="border: none !important;" class="container_salesman step_1">
                    <div style="width: 100% !important; margin-bottom: 20px !important;">
                        <span class="pull-left">Customer List</span> <span class="pull-right">Search: <input id="customerfilterinpt" style="color: black !important;" type="text" class=""></span>
                    </div>
                    <br>
                    <div style="height: 600px; overflow-y: auto; width: 100% !important;">
                        <table class="table table-condensed no wrap" id="driverTable">
                            <thead>
                                <tr>
                                    <th style="color: white;">Customer</th>
                                    <th style="color: white;">Salesman</th>
                                    <th style="color: white;">MCP</th>
                                    <th style="color: white;">Price Code</th>
                                    <th style="color: white;">Warehouse</th>
                                    <th style="color: white;">Status</th>
                                </tr>
                            </thead>
                            <tbody id="vehicleListData">
                                <tr>
                                    <td colspan="3" style="text-align: center;">No data as of now.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
                
    </div><!--main panel end-->

    <div class="modal fade" id="dispModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header modal-header-info">
                    <h2>Territory Information</h2>
                </div>
                <div class="modal-body">
                    <table class="table table-striped">
                        <tr>
                            <td><label>Territory Name:</label></td>
                            <td><p id="name-lbl"></p></td>
                        </tr>

                        <tr>
                            <td><label>Salesman:</label></td>
                            <td><p id="disp-salesman"></p></td>
                        </tr>

                        <tr>
                            <td><label>Date Created:</label></td>
                            <td><p id="date-created"></p></td>
                        </tr>

                        <tr>
                              <td><label>Color:</label></td>
                              <td><p id="terrcolor"></p></td>
                        </tr>
                        
                        <input type="hidden" name="mpa-id" id="mpa-id">
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-danger" onclick="deleteMPA()">Delete</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="duplicateUserModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">SESSION ENDED</h4>
                </div>
                <div class="modal-body">
                    <p>Sorry, your session has been disconnected. Another user is currently using your account.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="cofirmationDupUser()">GOT IT</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="updateFenceModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Fence Info</h4>
                </div>
                <div class="modal-body">
                    <div id="fenceContent"></div>    
                    <input type="hidden" id="fenceIDHolder">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-info btn-sm" style="float: left;" data-dismiss="modal" onclick="viewmarkers_inside_fence()">View Markers</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-danger ml-1" onclick="removeFence()">Removed</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="supportdetailsmodal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title dynamictitle"></h4><span class="pull-right">
                        Search: <input type="text" id="inputsearch_rvw_price">
                        <input type="text" id="inputsearch_rvw_warehouse">
                    </span>
                </div>
                <div class="modal-body">
                    <div style="height: 500px; overflow-y: auto;">
                        <table class="table table-hover table-sm" id="pricecodetable">
                            <thead>
                                <thead>
                                    <tr>
                                        <th>STOCKCODE</th>
                                        <th>DISCRIPTION</th>
                                        <th>PRICECODE</th>
                                        <th>UNITPRICE</th>
                                    </tr>
                                </thead>
                            </thead>
                            <tbody id="pricecodetable_Details"></tbody>
                        </table>
    
                        <table class="table table-hover table-sm" id="warehousetable">
                            <thead>
                                <tr>
                                    <th>STOCKCODE</th>
                                    <th>DISCRIPTION</th>
                                    <th>WAREHOUSE</th>
                                    <th>QTY</th>
                                    <th>STOCKUOM</th>
                                    <th>ALTERNATE UOM</th>
                                    <th>OTHER UOM</th>
                                    <th>CONVFACTALTUOM</th>
                                    <th>CONVFACTOTHUOM</th>
                                </tr>
                            </thead>
                            <tbody id="warehousetable_Details"></tbody>
                        </table>
                    </div>
                   
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://maps.googleapis.com/maps/api/js?v=weekly&key=AIzaSyAt0Pxe9_3DTav3DmUQzHfgd07s_LcJo7I&libraries=places,drawing,geometry"></script>
    <script src="/HASH/md5.js"></script>
    <script src="/HASH/aes.js"></script>
    <script src="/nestle/connectionString/LOCALSTORAGE/storage.js"></script>
    <script type="text/javascript" src="/web/web-commons.js"></script>
    <script type="text/javascript" src="/js/bootbox.min.js"></script>
    <script type="text/javascript" src="/js/scrolling.js"></script>
    <script src="https://cdn.datatables.net/v/bs5/dt-2.1.0/datatables.min.js"></script>
    <!-- <script type="text/javascript" src="js/customerMapping.js"></script> -->
  <script>
    var userID = localStorage.getItem('user_id');
    var user = localStorage.getItem("adminUserName");
    var usernm = localStorage.getItem("username");
    var usertype = localStorage.getItem("usertype");
    var site_lat = localStorage.getItem("latitude");
    var site_long = localStorage.getItem("longitude"); 
    var site_mapzoom = localStorage.getItem("mapzoom");  
    var dataTables;
    var GBLSITEINDI_SOSYO;
    var GLOBALDISTDBNAME;
    var territoryColor = document.getElementById("terrcolor");
    var GlobalColor = "";
    var ishide = false;

    function flip1() {
      if(ishide){
        $(".container_salesman.step_2").hide();
        $(".container_salesman.step_1").show(1000);
        $(".arrow-side-icon").css({"margin-top":"325px"});
        ishide = false;  
      } else{
        $(".container_salesman.step_1").hide();
        $(".container_salesman.step_2").show(1000);
        $(".arrow-side-icon").css({"margin-top":"155px"});
        ishide = true;
      }
      // $(".container_salesman").animate({width:'toggle'},500);
      $('.arrow-side-icon').toggleClass('fa-angle-right');
    }

  // var s = localStorage.getItem("srvr");
  // var u = localStorage.getItem("usrnm");
  // var p = localStorage.getItem("psswrd");
  // var d = localStorage.getItem("dtbse");
  // var con_info = [s, p, u, d];

    determineUserType(usertype); 

    // getAllSalesmanfuipanay();
    /*NOTIFICATION SECTION*/
    // showNotif();
    
    getcompname();

    function getcompname(){
      $.ajax ({
        url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php",
        type: "GET",
        data: {"type":"GET_COMPANYNAME", "CONN":con_info},
        dataType: "json",
        crossDomain: true,
        cache: false,       
        async: false,     
        success: function(r){ 
          $('#headingTitle').html(r[0].company.toUpperCase() +' / Site Admin - IT Champion v.1');
          GBLSITEINDI_SOSYO = r[0].DIST_CD;
          GLOBALDISTDBNAME = r[0].DIST_INDI;
        }
      });
    }   
    // $(document).on('click', '.dropdown-toggle', function(){
    //  $('.count').html('');
    //   showNotif('yes');
    // });

    // setInterval(function(){
    // showNotif();
    // }, 9000);

    $('[data-toggle="tooltip"]').tooltip(); 

    $('#navDrop').click(function() {
    $("i", this).toggleClass("glyphicon-menu-up glyphicon-menu-down");
  });

    function showNotif(view=''){
        //notification
      $.ajax ({
        url: "../geofencing/GeofencingAPI.php",
        type: "GET",
        data: {"type":"view_notifications_icon_"+user, "view":view},
        dataType: "JSON",
        crossDomain: true,
        cache: false,            
        success: function(response){ 
          // console.log('Notification function has been refresh');                
            $("#notifs-icon-div").html(response.notification);

              if(response.unseen_notification > 0)
              {
              $('.count').html(response.unseen_notification);
              }
            
        }
      });
    }
 
    /* if(localStorage.getItem("admin-userName") == null)
        window.location = "index.html";
    */
    history.pushState(null, null, document.URL);
    window.addEventListener('popstate', function () {
      history.pushState(null, null, document.URL);
    });

   //interval to get geofences 
    /* setInterval(function () { 
      //reset mpa
      if(mpa_polygon.length > 0){  
        for(var i = 0; i < mpa_polygon.length; i++){ 
          mpa_polygon[i].setMap(null);
        }
        mpa_polygon = [];
      }

        dashBoard_direct_marker();
      
    }, 20000);*/

   function getRandomColor() {
     var letters = '0123456789ABCDEF';
     var color = '#';
     for (var i = 0; i < 6; i++) {
       color += letters[Math.floor(Math.random() * 16)];
     }
     return color;
   }


  function getAllSalesmanfuipanay(){
      $.ajax ({
           url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php", 
           type: "GET",
           data: {"type":"get_all_salesman_bohol", "CONN":con_info},
           dataType: "html",
           crossDomain: true,
           cache: false,            
           success: function(response){  
           //console.log(response);             
            var data = JSON.parse(response);
            var option = '';
            for(var x = 0; x<data.length; x++){
             option += '<option value="'+data[x].mdCode+'">'+data[x].Salesman+'</option>';
            }
            $('#salesmanList').html(option);
           }//success here;
       })

   }

 function salesmanCol(salesman){
    var color;
    var fcolor;
    var ajaxTime= new Date().getTime();
    var totalTime= 0;

     $.ajax ({
             url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php", 
             type: "GET",
             data: {"type":"get_all_color_bohol", "site":user, "CONN":con_info},
             dataType: "JSON",
             crossDomain: true,
             cache: false,  
             async: false,          
             success: function(data){    
               fuipanay_salescolor = data.mdColor;
             }//success here;
         });
    //return color;
 }
 
  function clickSalesmanList() {
       var x = document.getElementById("salesmanList").selectedIndex;
       var result = document.getElementsByTagName("option")[x].value;
       alert(result);
   }

   var markers = [];
    function DeleteMarkers() {
     //Loop through all the markers and remove
     for (var i = 0; i < markers.length; i++) {
         markers[i].setMap(null);
     }
     markers = [];


     for (var i = 0; i < sosyomarkers.length; i++) {
      sosyomarkers[i].setMap(null);
     }
     sosyomarkers = [];
    }

    function deleteSoysoMarkers(){
      for (var i = 0; i < sosyomarkers.length; i++) {
        sosyomarkers[i].setMap(null);
      }
      sosyomarkers = [];
    }

    function deleteInsideMarkers(){
      for (var i = 0; i < inside_fence_markers.length; i++) {
        inside_fence_markers[i].setMap(null);
      }
      inside_fence_markers = [];
    }

    function clearMarker(){
     DeleteMarkers();

    }

    function getDate(){
       var today = new Date();
       var dd = today.getDate();
       var mm = today.getMonth()+1; //January is 0!
       var yyyy = today.getFullYear();

       if(dd<10) {
           dd = '0'+dd
       } 

       if(mm<10) {
           mm = '0'+mm
       } 

       today =  yyyy+'-'+ mm + '-' + dd;
       return String(today);

     }


   function displayGeofences (){
    var infoWindow = new google.maps.InfoWindow();
          $.ajax ({
               url: "https://fastdevs-api.com/FASTSOSYO/dist/API/applicationAPI.php",
               type: "GET",
               data: {
                'type':'GET_GEOFENCE_PER_DISTRIBUTOR',
                'distCode':GBLSITEINDI_SOSYO
               },
               dataType: "html",
               crossDomain: true,
               cache: false,            
               async: false,
               success: function(response){
                if(response != 0){
                    $("#res").html(response);
                    var ctr=0;

                    $(jQuery.parseJSON(response)).each(function() {   

                        
                    mpa_header[ctr] = [];
                    mpa_header[ctr][0] = this.pID;
                    mpa_header[ctr][1] = this.pNAME;
                    mpa_header[ctr][2] = this.pContact;
                    mpa_header[ctr][3] = this.Notation;
                    mpa_header[ctr][4] = this.PARTNERS;
                    mpa_header[ctr][5] = this.BUYINGCUSTOMERS;
                    mpa_header[ctr][6] = this.FSOSYO_DIST_CODE;
                    mpa_header[ctr][7] = [];
                    mpa_header[ctr][8] = this.COORDS;
                    mpa_header[ctr][9] = this.DATEADDED;
                    mpa_header[ctr][10] ='#97bcf7';
                    mpa_header[ctr][11] = this.pPartnersCount;
                    mpa_header[ctr][12] = this.cID;
                    mpa_header[ctr][13] = this.PARTNERID;
                    mpa_header[ctr][14] = this.PRICECODE;
                
                    ctr++;
                    });

                    for(var i = 0; i < mpa_header.length; i++){
                        var coord_ary=[];

                        //alert("MPAID " + mpa_header[i][5]);
                        for(var j = 0; j < mpa_header[i][8].length; j++){
                        //alert("COORDS " + mpa_header[i][5][j].MPALATITUDE + " " +  mpa_header[i][5][j].MPALONGITUDE);
                        coord_ary.push({lat: Number(mpa_header[i][8][j].HAZLATITUDE), 
                                        lng: Number(mpa_header[i][8][j].HAZLONGITUDE)});
                        }
                        var boundary = coord_ary;

                        mpaPolygon = new google.maps.Polygon({
                            paths: boundary,
                            strokeColor: mpa_header[i][10],
                            strokeOpacity: 1,
                            strokeWeight: 2,
                            fillColor: mpa_header[i][10],
                            fillOpacity: 0.7,
                            editable: false,
                            draggable: false,
                            pName: mpa_header[i][1],
                            pID: mpa_header[i][0],
                            acounts: mpa_header[i][5],
                            PARTNERS: mpa_header[i][4],
                            pContact: mpa_header[i][2],
                            Notation: mpa_header[i][3],
                            FSOSYO_DIST_CODE: mpa_header[i][6],
                            DATEADDED: mpa_header[i][9],
                            principalID:mpa_header[i][13],
                            partnerID:mpa_header[i][13],
                            priceCode:mpa_header[i][14]
                        });

                        mpa_polygon.push(mpaPolygon);

                   
                    }


                    //loop for polygon vertices
                    for(var i = 0; i < mpa_polygon.length; i++){ 
                        mpa_polygon[i].setMap(map);
                    
                       
                        google.maps.event.addListener(mpa_polygon[i], 'mouseout', function (e) {
                            infoWindow.close();
                        });

                        google.maps.event.addListener(mpa_polygon[i], 'click', function(e){
                            infoWindow.close();


                            $('#sys_distcode').val(this.FSOSYO_DIST_CODE);
                            $('#sys_areaname').val(this.pName);
                            $('#sys_contact').val(this.pContact);
                            $('#sys_notation').val(this.Notation);
                            $('#sys_partners').val(this.PARTNERS);
                            $('#sys_priceCode').val(this.priceCode);
                            $('#areaID').val(this.pID);

                            var cont = `
                                        <tr>
                                            <td colspan="3" class="text-center">no partners as of now.</td>
                                        </tr>`;
                            
                            $('#distCodeHolder').val(this.pID);
                            $('#partnersTab').html(cont);

                            get_dist_partners(this.pID);
                            
                            $('#updatePartnersModal').modal('show');

                        });
                    } 

                   }
               }
           });
        }//displayFCGeofences

  var marker, infoWindow, marker;
  function dashBoard_direct_marker(start, end){
   var compDist = 0;
   var salesman = $('#fencesalesmanList').val();

   var dialog = bootbox.dialog({
                  message: '<p style="text-align: center;"><i class="fa fa-spin fa-spinner"></i> processing request please wait...</p>',
                  backdrop: true
                // closeButton: false
                });
    var message = 'Successfully Saved!';
    var botboxMsg = '';
    var ajaxTime= new Date().getTime();
              

    var warehouselist = $('#fencesalesmanList').val();

        $.ajax ({
          url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php", 
         type: "GET",
         data: {
                  "type":"GET_ADNVANCE_ORDER", 
                  "start":startPickDate,
                  "end":endPickDate,
                  "warehouselist":warehouselist,
                  "CONN":con_info
               },
         dataType: "html",
         crossDomain: true,
         cache: false,
         success: function(response){ 
          var imglink = GLOBALLINKAPI+"/nestle/connectionString/images-stores/"+GLOBALDISTDBNAME+"/";
          dialog.modal('hide');
           if(response == 0){
                 console.log('empty dashboard!');
           }else{
             var data = JSON.parse(response); 
             for(var x=0; x<data.length; x++){

                marker = new google.maps.Marker({
                  id: data[x].mdCode,
                //   transCount: data[x].transCount,
                  loc: data[x].latitude+' '+data[x].longitude,
                  longitude: data[x].longitude,
                  latitude: data[x].latitude,
                  mdName: data[x].Salesman,
                  cID: data[x].cID,
                  mdCode: data[x].mdCode,
                  infowindow: infoWindow,
                  Address: data[x].Address,
                  Customer: data[x].CUSTOMER,
                  custCode: data[x].custCode,
                  dateRange: data[x].dateRange,
                  totalAmount: data[x].totalAmountFormatted,
                  totalAmount_raw: data[x].totalAmount,
                  position: new google.maps.LatLng(data[x].latitude,data[x].longitude),
                  map: map,
                  icon: {
                    //   url: 'https://fastdevs-api.com/MYBUDDYGLOBALAPI/mybuddyMarkerAPI/api/index.php/getMarker/'+data[x].mdColor.substr(1),
                      url: 'https://fastdevs-api.com/MYBUDDYGLOBALAPI/mybuddyMarkerAPI/api/index.php/getMarker/a83232',
                      // scaledSize: new google.maps.Size(32, 36)
                      scaledSize: new google.maps.Size(15, 17)
                  }
  
                });
                    
                     
                  markers.push(marker);

                  google.maps.event.addListener(marker, 'click', (function(marker, x) {
                    return function(){
                    
                  //  compDist = distance(data[x].latitude, data[x].longitude, data[x].transCount);
                    
                    lat1 = data[x].latitude; 
                    lon1 = data[x].longitude;
                    var contentString = "<div style='margin: 0 auto;'><div class='modal-header' style='text-align: center;'>"+
                      "<div class=''><img class='salesmanPic' alt='salesmanPic' src='"+imglink+data[x].custCode+".jpg' onError='imgError(this)'/><br/>"+
                      "<span class='fa fa-chevron-left pull-left' style='float: left; font-size: 30px;' id='prevMD'></span><span id='nextMD' class='fa fa fa-chevron-right pull-right' style='float: left; font-size: 30px;'></span></div></div>"+
                                                  "<div class='table-responsive'>" +
                                                    "<table class='table table-condensed' style='color: black !important;'>" +
                                                      "<tr><td>Salesman:</td><td id='getThisSalesman'>"+data[x].SALESMAN+"</td></tr>"+
                                                      "<tr><td>Customer:</td><td>"+data[x].CUSTOMER+"</td></tr>"+
                                                      "<tr><td>Location:</td><td id='getThisLongLat'>"+data[x].latitude +' '+data[x].longitude+"</td></tr>"+
                                                      "<tr><td>Sales:</td><td>&#8369; "+data[x].totalAmountFormatted+"</td></tr>"+
                                                      "</div>"+
                                                    "</table>"+
                                                  "</div>";
                            
                            infoWindow.setContent(contentString);
                            infoWindow.open(map, marker);
                            
                      }
                  
                  })(marker, x));
             }//end for  
           }
         }, error: function(XMLHttpRequest, textStatus, errorThrown) {
              botboxMsg = '<b style="color: red;">Ops! Something went wrong!</b>' + XMLHttpRequest.responseText;
              var totalTime = new Date().getTime()-ajaxTime;
            
              dialog.init(function(){
                    setTimeout(function(){
                      dialog.find('.bootbox-body').html('<p>'+botboxMsg+'</p>');
                  }, 1000);
              });
            }
            });
              
       
     infoWindow = new google.maps.InfoWindow;
   }//end direct dashboard colpal
   
   

     function deleteMPA(){
          if (confirm("Are you sure do you want to delete this boundary?")) {
             $.ajax ({
                 url: "/geofencing/GeofencingAPI.php", 
                 type: "GET",
                 data: {"type":"delete_mpa_"+user, "id": $("#mpa-id").val()},
                 dataType: "html",
                 crossDomain: true,
                 cache: false,            
                 success: function(response){                  
                   alert(response);
                    $('#dispModal').modal('toggle');
                 },
                 error: function (err, statusText, errorThrown){
                   alert(errorThrown);
                 }
             })
             $("#dispModal").on("hidden.bs.modal", function (){
                     location.reload();
             });
       }
     }//deleteMPA

  function erase(polygon){
     polygon.setMap(null);
  }

  function dragendpolygon(polygon){
    google.maps.event.addListener(polygon,'click',function() {
      checkWithinMPA(polygon);
     
      $('#createTerrModal').modal('show');
    //   getsosyostores(polygon);
    });
  }
 
 siteLocation();
 var sitelat, sitelng, sitezoom;
 var inside_fence_markers = [];
 var insidemarkers = [];
 var infoWindow = new google.maps.InfoWindow;
 function init(){
  
     var lat, lang, zoomLevel = 0;
     lat = parseFloat(sitelat);
     lang = parseFloat(sitelng);
     zoomLevel = parseInt(sitezoom);
     myLatlng = new google.maps.LatLng(lat, lang);
    
     mapOptions = {
       zoom: 9,
       center: myLatlng,
       mapTypeId: 'roadmap',
       controlSize: 20,
       styles: [
  {
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#f5f5f5"
      }
    ]
  },
  {
    "elementType": "labels.icon",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#616161"
      }
    ]
  },
  {
    "elementType": "labels.text.stroke",
    "stylers": [
      {
        "color": "#f5f5f5"
      }
    ]
  },
  {
    "featureType": "administrative.land_parcel",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#bdbdbd"
      }
    ]
  },
  {
    "featureType": "poi",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#eeeeee"
      }
    ]
  },
  {
    "featureType": "poi",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#757575"
      }
    ]
  },
  {
    "featureType": "poi.park",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#e5e5e5"
      }
    ]
  },
  {
    "featureType": "poi.park",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#9e9e9e"
      }
    ]
  },
  {
    "featureType": "road",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#ffffff"
      }
    ]
  },
  {
    "featureType": "road.arterial",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#757575"
      }
    ]
  },
  {
    "featureType": "road.highway",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#dadada"
      }
    ]
  },
  {
    "featureType": "road.highway",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#616161"
      }
    ]
  },
  {
    "featureType": "road.local",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#9e9e9e"
      }
    ]
  },
  {
    "featureType": "transit.line",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#e5e5e5"
      }
    ]
  },
  {
    "featureType": "transit.station",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#eeeeee"
      }
    ]
  },
  {
    "featureType": "water",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#c9c9c9"
      }
    ]
  },
  {
    "featureType": "water",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#9e9e9e"
      }
    ]
  }
]
     }
     map = new google.maps.Map(document.getElementById('map'), mapOptions);
     new setRestoreBtn(map);
     new setEraseBtn(map);
     new generateBaseMarker(map);
     new maintab(map);

    view_vehilcle_details();
    displayGeofences();



 }//init


        
 var GBLPOLYGON;
 function getpolygonpath(){
        var vertices = GBLPOLYGON.getPath();
        for (var i =0; i < vertices.getLength(); i++) {
                var xy = vertices.getAt(i);
                mpa_coords[i]=[];
                mpa_coords[i][0]= i;
                mpa_coords[i][1]= xy.lat();
                mpa_coords[i][2]= xy.lng();
                
                contentString += mpa_coords[i][0] + " " + mpa_coords[i][1] + " " + mpa_coords[i][2] + "&#13;&#10;";
            }

            $("#coords-info").html(contentString);

            contentString="";
    }


  function createterremodal(){
    var checker = $('#sysproStores').val();
    if($.trim(checker) == ''){
      alert('Please select a salesman and draw a territory fence first.');
    }else{
      $('#fenceName').val('');
      $('#createTerrModal').modal('show');
    }

    console.log(checker);
  }

  function refreshTerr(){
    // getsosyostores(GBLPOLYGON);
    checkWithinMPA(GBLPOLYGON);
    $('#fenceName').val('');
  }

  var mapOptions, map, marker, mpaPolygon, contentString = "", mpa_coords = [[]];
  var mpa_header=[[]];
  var mpa_polygon=[];

    function saveMPA(){

      getpolygonpath();

      var userID = localStorage.getItem('user_id');
      var fullname = localStorage.getItem('fullname');
      var fenceName= $('#fenceName').val();

      // var tsysprostores = $('#sysproStores').val();
      // var tsosyostores = $('#sosyoStores').val();
      // var daterange = $('#dateRangeselected').val();
      // var totalSelected = $('#totalSalesSelected').val();


      var loadingcap = $('#loadingCap').val();
      var totalAmountHolder = $('#totalAmountHolder').val();
      var plateNo = $('#plateNumberHolder').val();
      var totaltransaction = $('#sysproStores').val();
      var unloadingDate = $('#unloadingDate').val();


      if(plateNo == ''){
            alert('Please select a vehicle.');
      }else if(unloadingDate == undefined || unloadingDate == ''){
          alert('Please select unloading date.');
      }else{
        var f = confirm('Are you sure you want to create this route?');
        if(f){

            $('#createTerritoryBtn').html('<i class="fa fa-spin fa-spinner"></i> please wait...');
            $('#createTerritoryBtn').prop('disabled', true);
              $.ajax ({
                  url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php", 
                  type: "GET",
                  data: {
                          "type":"INSERT_DYNAMIC_ROUTE_HEADER", 
                          loadingcap:loadingcap,
                          totalAmountHolder:totalAmountHolder,
                          plateNo:plateNo,
                          totaltransaction:totaltransaction,
                          unloadingDate:unloadingDate,
                          "CONN":con_info,
                      },
                  dataType: "json",
                  crossDomain: true,
                  cache: false, 
                  async: true,          
                  success: function(response){           
                      mpa_coords = [[]];      
                      var r = sosyoStoresArrHolder;
                      var routingrefno = response;

                      // console.log(r);
                      for(var x = 0; x < r.length; x++){
                          // savefenceStores(response.cIDheader,
                          // r[x].STORETYPE,
                          // r[x].SALESMAN,
                          // r[x].CUSTCODE,
                          // r[x].STORENAME,
                          // r[x].DATECREATED_INFO,
                          // r[x].ADDRESS,
                          // r[x].NOORDERS,
                          // r[x].TOTALORDERS,
                          // r[x].LONGITUDE,
                          // r[x].LATITUDE,
                          // r[x].LASTORDER);

                          // console.log(r[x].cID);
                          exec_tagged_dynamicroute_transactions(r[x].cID, routingrefno, plateNo, unloadingDate);
                      }

                      // alert("Route plan was successfully created.");

                      setTimeout(function() { 
                          alert("Route plan was successfully created.");
                          location.reload();
                      }, 2000);
                   
                  },
                  error: function (err, statusText, errorThrown){
                      alert(errorThrown);
                  }
              });
          }//inside if close
      }//main else close

     }//saveMPA




  function maintab(map){
    this.map = map;
    var dashbaord_table = document.getElementById('outerContainer_id');
    this.map.controls[google.maps.ControlPosition.LEFT].push(dashbaord_table);

  }
 function setRestoreBtn(map){
    this.map = map;
    var btn = document.getElementById('restorBtn');
    this.map.controls[google.maps.ControlPosition.RIGHT].push(btn);

 }

 function setEraseBtn(map){
    this.map = map;
    var btn = document.getElementById('eraseBtn');
    this.map.controls[google.maps.ControlPosition.RIGHT].push(btn);
 }

 function generateBaseMarker(map){
    this.map = map;
    var btn = document.getElementById('generateBaseMarker');
    this.map.controls[google.maps.ControlPosition.RIGHT].push(btn);
 }

 


function restoreLoc(){
   
    for (var i = 0; i < markers.length; i++) {
           markers[i].setAnimation(null);
         }
     map.setCenter(myLatlng);
     map.setZoom(10);
     pasthisLat = 0;
     pasthisLong = 0;
 }




    datePicker();
      var startPickDate, endPickDate;
      function datePicker(){
       var start = moment().subtract(29, 'days');
        var end = moment();

        $('#reportrange1').daterangepicker({
            "alwaysShowCalendars": true,
            "startDate": start,
            "endDate": end,
            "maxDate": moment(),
            "applyClass": "btn-primary",
            "autoApply": false,
            ranges: {
               'Today': [moment(), moment()],
               'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
               'Last 7 Days': [moment().subtract(6, 'days'), moment()],
               'This Month': [moment().startOf('month'), moment().endOf('month')],
               'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            }
        }, function(start, end, label) {
            $('#reportrange1 span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
            startPickDate = start.format('YYYY-MM-DD');
            endPickDate = end.format('YYYY-MM-DD')
          });

        $('#reportrange1').on('apply.daterangepicker', function(ev, picker) {
          $('#stockRequest_TAB').hide();
          var start = picker.startDate.format('YYYY-MM-DD');
          var end = picker.endDate.format('YYYY-MM-DD');
          // dashBoard_direct_marker(start, end);

          startPickDate = start;
          endPickDate = end;

        });
      }
    
    function proceedFilter(){
      $('#filterDetailsModal').modal('hide');
      deleteSoysoMarkers();
      DeleteMarkers();
      deleteInsideMarkers();
      dashBoard_direct_marker(startPickDate, endPickDate);
   
    }

    // loadwarehouseTypes();
    function loadwarehouseTypes(){   

    $("#fencesalesmanList").multiselect('destroy');
    $.ajax ({
        url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php",
        type: "GET",
        data: {
                "type":"GET_BTDT_WAREHOUSE_TYPES",
                // "salesmanType":salesmanType,
                "CONN":con_info
              },
        dataType: "json",
        crossDomain: true,
        cache: false,          
        async: false,  
          success: function(data){ 
            var cont = '';
            for(var x = 0; x<data.length; x++){
                cont += '<option value="'+data[x].WarehouseCode+'">'+data[x].WAREHOUSEDESC+'</option>';
            }
            //  $("#fencesalesmanList").html('').html(cont);
            $("#fencesalesmanList").html(cont);
            //  $('#fencesalesmanList').multiselect('rebuild');

          
            // $("#fencesalesmanList").multiselect('refresh'); 
            // //  $('#fencesalesmanList').multiselect('refresh');

            $('#fencesalesmanList').multiselect({
              numberDisplayed: 1,
              enableCaseInsensitiveFiltering: true,
              includeSelectAllOption: true,
              selectAllNumber: true,
              buttonWidth: '300px',
              maxHeight: 300
            });

            
          }
      });
    }

    // loadSalesman('ALL');
    function loadSalesman(salesmanType){   

      $("#fencesalesmanList").multiselect('destroy');
     $.ajax ({
          url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php",
          type: "GET",
          data: {
                  "type":"get_salesmanLoad_mcprecalibration",
                  "salesmanType":salesmanType,
                  "CONN":con_info
                },
          dataType: "json",
          crossDomain: true,
          cache: false,          
          async: false,  
            success: function(data){ 
              var cont = '';
              for(var x = 0; x<data.length; x++){
                  cont += '<option value="'+data[x].mdCode+'">'+data[x].Salesman+'</option>';
               }
              //  $("#fencesalesmanList").html('').html(cont);
               $("#fencesalesmanList").html(cont);
              //  $('#fencesalesmanList').multiselect('rebuild');

             
              // $("#fencesalesmanList").multiselect('refresh'); 
              // //  $('#fencesalesmanList').multiselect('refresh');

              $('#fencesalesmanList').multiselect({
                numberDisplayed: 1,
                enableCaseInsensitiveFiltering: true,
                includeSelectAllOption: true,
                selectAllNumber: true,
                buttonWidth: '300px',
                maxHeight: 300
              });

               $('#salesmanType').multiselect({
                  numberDisplayed: 1,
                  enableCaseInsensitiveFiltering: true,
                  includeSelectAllOption: true,
                  selectAllNumber: true,
                  buttonWidth: '300px',
                  maxHeight: 300
               });
             }
        });
    }


$('#salesmanType').on('change', function() {
  var salesmanType = this.value;
  loadSalesman(salesmanType);
});


  var sosyomarkers = [];
  var sosyomarker = [];
  var sosyoStoresArrHolder = [];
  var sysproStoresArrHolder = [];
  var sosyocustomer = 0;
  function getsosyostores(mpa_polygon){
    deleteSoysoMarkers();
    $.ajax ({
          url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php", 
         type: "GET",
         data: {
                  "type":"GET_SOSYO_STORES", 
                  'fastsosyo_distcode': GBLSITEINDI_SOSYO,
                  "CONN":con_info
               },
         dataType: "json",
         crossDomain: true,
         cache: false,
         async: false,
         success: function(data){ 
          sosyocustomer = 0;
          for(var x=0; x<data.length; x++){
            var contentString = `
                            <div style='margin: 0 auto; color: black !important;'>
                                <div style='text-align: center;'>
                                    <img class='storemarkerImage' alt='storeImage' src="https://fastdevs-api.com/FASTSOSYO/download/image/storeimage/`+data[x].USERID+`.jpg"/>
                                </div>
                                <table class="table table-sm table-striped">
                                    <tr>
                                        <td style="width: 100px;">Store Name</td>
                                        <td><strong>` + data[x].STORENAME.toUpperCase() + `</strong></td>
                                    </tr>
                                    <tr>
                                        <td>Date Created</td>
                                        <td><strong>` + data[x].DATECREATED + `</strong></td>
                                    </tr>
                                    <tr>
                                        <td>Address</td>
                                        <td><strong>` + data[x].ADDRESS + `</strong></td>
                                    </tr>
                                    <tr>
                                        <td># Orders</td>
                                        <td><strong>` + data[x].NOOFORDERS + `</strong></td>
                                    </tr>
                                    <tr>
                                        <td>Total Orders</td>
                                        <td><strong>&#8369;` + data[x].TOTALORDERS + `</strong></td>
                                    </tr>
                                    <tr>
                                        <td>Last Order</td>
                                        <td><strong>` + data[x].LASTORDER + `</strong></td>
                                    </tr>
                                </table>
                            <div/>`;


            var latlng = new google.maps.LatLng(data[x].LATITUDE, data[x].LONGITUDE);
              if(google.maps.geometry.poly.containsLocation(latlng, mpa_polygon)){ 
                sosyocustomer++;
                  sosyomarker = new google.maps.Marker({
                    loc: data[x].LATITUDE+' '+data[x].LONGITUDE,
                    longitude: data[x].LONGITUDE,
                    latitude: data[x].LATITUDE,
                    storename: data[x].STORENAME,
                    infoWindow: infoWindow,
                    contentString:contentString,
                    position: new google.maps.LatLng(data[x].LATITUDE,data[x].LONGITUDE),
                    map: map,
                    icon: {
                        url: 'https://fastsosyo.com/comports/admin/v2/html/AIOSTORE_MARKER/sosyo2_marker.png',
                        scaledSize: new google.maps.Size(11, 17)
                    }
                });
                      
                    
                sosyomarkers.push(sosyomarker);    


                sosyoStoresArrHolder.push({
                  STORETYPE: 'SOSYOSTORES',
                  SALESMAN: '---',
                  CUSTCODE: '---',
                  cID: data[x].cID,
                  STORENAME: data[x].STORENAME,
                  DATECREATED_INFO: data[x].DATECREATED,
                  ADDRESS: data[x].ADDRESS,
                  NOORDERS: data[x].NOOFORDERS,
                  TOTALORDERS: data[x].TOTALORDERS,
                  LASTORDER: data[x].LASTORDER,
                  LONGITUDE: data[x].LONGITUDE,
                  LATITUDE: data[x].LATITUDE
                });


                // storeListForInsert.push(sosyoStoresArrHolder);

              }
            

              google.maps.event.addListener(sosyomarker, 'click', (function(sosyomarker, x) {
                    return function(){
                      infoWindow.setContent(this.contentString);
                      infoWindow.open(map, sosyomarker);
                    }
              })(sosyomarker, x));
              
            }//end for  


         }
      });

      infoWindow = new google.maps.InfoWindow;
  }


$(window).bind("load", function () {
     $('#work-in-progress').fadeOut();

 });

function myFunction() {
 var x = document.getElementById("myTopnav");
 if (x.className === "topnav") {
     x.className += " responsive";
 } else {
     x.className = "topnav";
 }
} 


var markers = [];
function view_vehilcle_details(){
    console.log(GBLSITEINDI_SOSYO);
  $.ajax ({
      url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php",
      type: "GET",
      data: {
          "type":"GET_NWSOSYO_ACTIVATIONS_ALL",
          'distCode':GBLSITEINDI_SOSYO,
          "CONN":con_info,
          },
      dataType: "json",
      crossDomain: true,
      cache: false,           
      async: false, 
      success: function(r){
        GBLDRIVERLISTHOLDER = r;
        var cont = ``;
        for(var x = 0; x <r.length; x++){
            var stattext = '<b style="color: #24ed85; font-weight: bold;">Activated</b>';
            if(r[x].Status == 'PENDING'){
                stattext = '<b style="color: orange; font-weight: normal;">Pending</b>';
            }
            cont += '<tr onclick="viewmarkerdetails(\''+r[x].STOREID+'\')">'+`
                        <td>`+r[x].Customer+'_'+r[x].STORENAME+`</td>
                        <td>`+r[x].Salesman+`</td>
                        <td>`+r[x].mcpDay+`</td>
                        <td>`+r[x].priceCode+`</td>
                        <td>`+r[x].warehouse+`</td>
                        <td style="text-align: center;">`+stattext+`</td>
                     </tr>`;

            var contentString = `
                 <div style='text-align: center;'>
                    <img class='storemarkerImage' alt='storeImage' src="https://fastdevs-api.com/FASTSOSYO/download/image/storeimage/`+r[x].USERID+`.jpg"/>
                </div>
                    <div style='margin: 0 auto;'>
                        <table class="table table-sm table-striped" style="color: black !important;">
                              <tr>
                                <td>Syspro Store name</td>
                                <td><strong>` + r[x].Customer +'_'+r[x].CustName + `</strong></td>
                            </tr>
                            <tr>
                                <td>Store Name</td>
                                <td><strong>` + r[x].STORENAME.toUpperCase() + `</strong></td>
                            </tr>
                            <tr>
                                <td>Salesman</td>
                                <td><strong>` + r[x].Salesman.toUpperCase() + `</strong></td>
                            </tr>
                            <tr>
                                <td>MCP Day</td>
                                <td><strong>` + r[x].mcpDay + `</strong></td>
                            </tr>
                            <tr>
                                <td>Price Code</td>`+
                                '<td><strong>' + r[x].priceCode + '</strong> <span onclick="reviewsupp_pCode(\''+r[x].priceCode+'\')" style="margin-left: 20px; cursor: pointer; color: blue;">Review</span></td>'+`
                            </tr>
                            <tr>
                                <td>Warehouse</td>`+
                                '<td><strong>' + r[x].warehouse + '</strong> <span onclick="reviewsupp_whouse(\''+r[x].warehouse+'\')" style="margin-left: 9px; cursor: pointer; color: blue;">Review</span></td>'+`
                            </tr>
                              <tr>
                                <td>Channel</td>
                                <td><strong>` + r[x].Channel + `</strong></td>
                            </tr>
                             <tr>
                                <td>Tier Description</td>
                                <td><strong>` + r[x].TierDesc + `</strong></td>
                            </tr>
                              <tr>
                                  <td>Version No.</td>
                                  <td><strong>` + r[x].VERSIONNO + `</strong></td>
                              </tr>
                            <tr>
                                <td>Status</td>
                                <td><strong>` + r[x].Status + `</strong></td>
                            </tr>
                        </table>
                    <div/>`;

            var myLatLng = { lat: parseFloat(r[x].LATITUDE), lng: parseFloat(r[x].LONGITUDE) };
            var marker = new google.maps.Marker({
                position: myLatLng,
                storeID: r[x].STOREID,
                map,
                infowindow: infoWindow,
                content: contentString,
                title: r[x].STORENAME,
                icon: {
                        url:'AIOSTORE_MARKER/sosyo2_marker.png',
                        scaledSize: new google.maps.Size(11, 17)
                    }
            });
            // map.setCenter(marker.getPosition());

            google.maps.event.addListener(marker, 'click', (function(marker, x) {
                return function(){
                lat1 = r[x].latitude;
                lon1 = r[x].longitude;
                    new google.maps.InfoWindow({ maxWidth: 500});
                    infoWindow.setContent(this.content);
                    infoWindow.open(map, marker);
                }

            })(marker, x));

            markers.push(marker);
        }   


          $('#vehicleListData').html(cont);
        }//success
    });
            
}


function viewmarkerdetails(storeID){

//  var infoWindow = new google.maps.InfoWindow;
    console.log(storeID);
    var r = markers;
    for(var x =0; x < r.length; x++){
        if(r[x].storeID == storeID){
            new google.maps.InfoWindow({ maxWidth: 500});
            infoWindow.setContent(r[x].content);
            infoWindow.open(map, r[x]);
        }
    }
}

$('.step_1').show();
$('.step_2').hide();
function useplateNumber(mdCode, salesmanname, loadingcap){

  // alert(mdCode);

  $('#vehicleName').val(salesmanname);
  $('#loadingCap').val(loadingcap);

  $('#plateNumberHolder').val(mdCode);
  

  $('#vehicleinuse').html(mdCode +' ('+salesmanname + ')<br>Loading Capacity: '+parseFloat(loadingcap).toLocaleString());

  $('.step_1').hide();
  $('.step_2').show();
  ishide = true;
}

  function removeFence(){
    var cID = $('#fenceIDHolder').val();
    var f = confirm('Are you sure you want to remove this geofence?');
    if(f){
        $.ajax({
            type: "GET",
            url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php",
            data: {
                        "type": 'REMOVE_FENCE',
                        'cID': cID,
                        "CONN":con_info
                    },
            dataType: "JSON",
            crossDomain: true,
            cache: false,
            async: false,
            success: function (r) {
                if(r){
                    alert('Fence successfully remove.');
                    location.reload();
                }
            }
        });
    }
  }


 function exportFence(){
  var win = window.open('dynamic_route', '_blank');
    if (win) {
        //Browser has allowed it to be opened
        win.focus();
    } else {
        //Browser has blocked it
        alert('Please allow popups for this website');
    }
 }

 function empt(){
   alert('Link is temporarily not available!');
 }

  $(window).bind("load", function () {
   $('#work-in-progress').fadeOut();
});

(function($) {
$.fn.clickToggle = function(func1, func2) {
   var funcs = [func1, func2];
   this.data('toggleclicked', 0);
   this.click(function() {
       var data = $(this).data();
       var tc = data.toggleclicked;
       $.proxy(funcs[tc], this)();
       data.toggleclicked = (tc + 1) % 2;
   });
   return this;
};
}(jQuery));


$("#navBtn").clickToggle(function() {   
 openNav();
}, function() {
   closeNav();
});


$("#generateBaseMarker").click(function() {   
    // dashBoard_direct_marker();
    DeleteMarkers();
    $('#filterDetailsModal').modal('show');
});



function imgError2(image) {
 image.onerror = "";
 image.src = "../img/salesmanPic.jpg";
 return true;
}  

function openNav() {
document.getElementById("mySidenav").style.width = "270px";
document.getElementById("main").style.marginLeft = "270px";
}

function closeNav() {
document.getElementById("mySidenav").style.width = "0";
document.getElementById("main").style.marginLeft= "0";
}


function reviewsupp_pCode(priceCode){
    $('#pricecodetable').show();
    $('#warehousetable').hide();

    $('#inputsearch_rvw_price').show();
    $('#inputsearch_rvw_warehouse').hide();
    $.ajax ({
      url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php",
      type: "GET",
      data: {
          "type":"GET_DIST_PRICE_DETAILS",
          'distCode':GBLSITEINDI_SOSYO,
          'priceCode':priceCode,
          "CONN":con_info,
          },
      dataType: "json",
      crossDomain: true,
      cache: false,           
      async: false, 
      success: function(r){
        var cont = ``;
        for(var x =0; x < r.length; x++){
            cont+= `<tr>
                        <td>`+r[x].STOCKCODE+`</td> 
                        <td>`+r[x].DESCRIPTION+`</td>
                        <td>`+r[x].PRICECODE+`</td>
                        <td>`+r[x].UNITPRICE+`</td>
                   </tr>`;
        }
        $('#pricecodetable_Details').html(cont);
        $('.dynamictitle').html('Price Code '+priceCode+ ' Details');
        $('#supportdetailsmodal').modal('show');
      }
    });
   

}

function reviewsupp_whouse(warehouse){
    $('#pricecodetable').hide();
    $('#warehousetable').show();

    $('#inputsearch_rvw_price').hide();
    $('#inputsearch_rvw_warehouse').show();
    $.ajax ({
      url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php",
      type: "GET",
      data: {
          "type":"GET_DIST_INV_DETAILS",
          'distCode':GBLSITEINDI_SOSYO,
          'warehouse':warehouse,
          "CONN":con_info,
          },
      dataType: "json",
      crossDomain: true,
      cache: false,           
      async: false, 
      success: function(r){
        var cont = ``;
        for(var x =0; x < r.length; x++){
            cont+= `<tr>
                        <td>`+r[x].STOCKCODE+`</td> 
                        <td>`+r[x].DESCRIPTION+`</td>
                        <td>`+warehouse+`</td>
                        <td>`+r[x].QUANTITY+`</td>
                        <td>`+r[x].StockUom+`</td>
                        <td>`+r[x].AlternateUom+`</td>
                        <td>`+r[x].OtherUom+`</td>
                        <td>`+r[x].ConvFactAltUom+`</td>
                        <td>`+r[x].ConvFactOthUom+`</td>
                   </tr>`;
        }
        $('#warehousetable_Details').html(cont);
        $('.dynamictitle').html('Warehouse Code '+warehouse+ ' Details');
        $('#supportdetailsmodal').modal('show');
      }
    });

}

$("#customerfilterinpt").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#vehicleListData tr").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  });

  $("#inputsearch_rvw_price").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#pricecodetable_Details tr").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  });

  $("#inputsearch_rvw_warehouse").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#warehousetable_Details tr").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  });
  



    </script>

  
</body>
</html>

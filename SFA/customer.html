<!DOCTYPE html>
<html>
<head>
  <title>
     Customer Maintenance
  </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
 <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
 
 <link rel="shortcut icon" href="/img/mdlogo_web.png" type="image/png"/>
 <link rel="stylesheet" href="/css/mdDesign.css"/>

  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.5.6/css/buttons.dataTables.min.css">
</head>
<body>
  <div id="mySidenav" class="sidenav">
  <div class='image'><img alt='mdbuddylogo' class='logoMd' src='/img/mdbuddylogo_jeff.png'/></div>
    <a href="https://mybuddy-sfa.com/SFA/Dashboard"> <span class='glyphicon glyphicon-home'></span> Dashboard</a>
    <a href="https://mybuddy-sfa.com/SFA/digitalMapping"> <span class='glyphicon glyphicon-map-marker'></span> Digital Mapping</a>
    <a href="https://mybuddy-sfa.com/SFA/customerMapping"> <span class="fa fa-users" aria-hidden="true"></span> Customer Mapping</a>
    <a href="territoryGeofencing"> <span class='glyphicon glyphicon-cog'></span> Territory Geofencing</a>
   <a data-toggle="collapse" href="#collapse1" id='navDrop'> <span class='glyphicon glyphicon-duplicate' id='changeIcon'></span> Reports
    <i class="glyphicon glyphicon-menu-down pull-right"></i> </a>
      <div id="collapse1" class="panel-collapse collapse" style="margin-left: 17px; font-size: 5px !important">
        <a href="salesReport"> Sales Report</a>
        <a href="fastsosyotransaction"> Fastsosyo Transaction</a>
        <a href="salesAudit"> Sales Audit</a>
        <a href="transactionLedger"> Transaction Ledger</a>
        <a href="UnprocessedOrders"> Unprocessed Orders</a>
        <a href="dsr"> DSR</a>
        <a href="dcr"> Daily Collection</a>
        <a href="stockRequest"> Stock Request</a>
        <a href="unuploaded"> Unuploaded</a>
        <a href="BOReport"> BO</a>
        <a href="Stocktake Report"> Stocktake</a>
        <a href="inventory"> Inventory Valuation</a>
        <a href="jobberMaintenance"> Jobber</a>
        <a href="syncreport">Sync Report</a>
        <a href="soaprvreport">SO Approval</a>
      </div>
   <a data-toggle="collapse" href="#collapse2" id='navDrop' class="maintenanceCont"> <span class="fa fa-cogs" aria-hidden="true" id='changeIcon'></span> Maintenance
    <i class="glyphicon glyphicon-menu-down pull-right"></i> </a>
      <div id="collapse2" class="panel-collapse collapse" style="margin-left: 17px; font-size: 9px !important">
        <a href="dataMaintenance"> Data</a>
        <a href="customer"  class='activeYes'> Customer</a>
        <a href="cmf">CMF</a>
        <a href="geoReset"> Georeset</a>
        <a href="salesman"> Salesman</a>
        <a href="product"> Product</a>
        <a href="productbtdt"> BTDT Product</a>
        <a href="customerTagging"> Tagging</a>
        <a href="bankmaintenance"> Bank</a>
        <a href="mcpcalibration">MCP Calibration</a>
      </div>
  <!-- <a href="Alert"> <span class='glyphicon glyphicon-envelope'></span> Alert Messages</a> -->
  <hr />
  <a href="https://mybuddy-sfa.com/SFA/v2/dashboard">Switch to New Dashboard</a>

   <!--<div class='hideNav'>
      <a href="#" class="btn btn-primary btn-nav" onclick='closeNav()'>
          <span class='glyphicon glyphicon-menu-left' style='color:white;'></span>
      </a>
    </div>-->
  </div>
  <div id="main">
  <h4 class="display-4 dispMargin">
          <a href="#" id='navBtn' class="btn btn-primary"  style='margin-right: 15px; outline: none;'>
            <span class="glyphicon glyphicon-menu-hamburger"></span> 
          </a>
          <span onclick='closeNav()'>
            <i class="fas fa-clipboard-list"></i> Customer
            <!--<span class='pull-right' >
                  <img src="img/colpal.png" alt="nutriasia" style="float:right;">
            </span>-->
              <span class="nav navbar-nav navbar-right">
                <li class="dropdown">
                  <a style='float:right;' href="#" class="dropdown-toggle" data-toggle="dropdown" id='dropThisDown'>
                      <span class="label label-pill label-danger count" style='border-radius: 10px; font-size: 10px;'></span>
                      <span class="fa fa-bell"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-pill">
                    <div id="notificationElement" class="scroll" data-simplebar>
                        <div id='notifs-icon-div'></div>
                    </div>
                    <a type="button" class="btn btn-default btn-block" href='Alert' id='seeAll' >See all</a>
                  </ul>
                </li>
                <li class="dropdown">
                  <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fas fa-user"></i>
                  </a>
                  <ul class="dropdown-menu dropdown-user">
                      <li><a href="Profile.html"><i class="fas fa-user"></i> My Account</a>
                      </li>
                      <li class="divider"></li>
                      <li><a href="#" id="admin-logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                      </li>
                  </ul>
                </li>
              </span>
            </span>
          </h4>

         <div class="panel cust-panel">
               <div class="panel-heading">
                   <i class="fas fa-clipboard-list"></i> <span id="titleHeading"></span>
               </div>
                <div class="panel-body" style='background-color:#fff; color: black;'>   
                  <div class="table-responsive">
                    <table class="table table-hover display nowrap customerList" style="width: 100%;">
                       <thead>
                        <tr>
                          <th>SALESMAN</th>
                          <th>CUST NAME</th>
                          <th>ORDER TYPE</th>
                          <th>ADDRESS</th>
                          <th>CONTACT PERSON</th>
                          <th>CONTACT #</th>
                          <th>CUST TYPE</th>
                        </tr>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>
                  </div>
               </div>
         </div><!--main panel end-->

         <div class="modal fade" id="tojobbermodal" role="dialog">
            <div class="modal-dialog">
              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4 class="modal-title">CUSTOMER DETAILS</h4>
                </div>
                <div class="modal-body">
                  <table class="table table-hover">
                    <tr>
                      <td>SALES PERSON:</td>
                      <td><input type="text" name="" id="mdCodeH" class="job-inpt-data-h"></td>
                    </tr>
                    <tr>
                      <td>CUSTOMER NAME:</td>
                      <td id=""><input type="text" name="" id="customerH" class="job-inpt-data-h"></td>
                    </tr>
                    <tr>
                      <td>MOBILE:</td>
                      <td><input type="text" name="" id="contactnumH" class="job-inpt-data-h"></td>
                    </tr>
                    <tr>
                      <td>CONTACT PERSON:</td>
                      <td id=""><input type="text" name="" id="contactPersonH" class="job-inpt-data-h"></td>
                    </tr>
                    <tr>
                      <td>ADDRESS:</td>
                      <td id=""><input type="text" name="" id="addressH" class="job-inpt-data-h"></td>
                    </tr>
                    <tr>
                      <td>CUST TYPE:</td>
                      <td id=""><input type="text" name="" id="custTypeH" class="job-inpt-data-h"></td>
                    </tr>
                    <tr>
                      <td>ORDER TYPE:</td>
                      <td id="orderTypeText"></td>
                    </tr>
                    

                  </table>
                  <input type="hidden" name="" id="latH">
                  <input type="hidden" name="" id="longH">
                  <input type="hidden" name="" id="custCodeH">
                  <input type="hidden" name="" id="isLockH">
                </div>
                <div class="modal-footer">
                  <small class="text-info pull-left infoFooter"></small>
                  <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-primary" id="addJobberBtn" data-dismiss="modal" onclick="exec_insertCustomer()">Yes</button>
                  <button type="button" class="btn btn-primary" id="revertBtn" data-dismiss="modal" onclick="exec_insertCustomer_revert()">Yes</button>
                </div>
              </div>
            </div>
          </div>

          <div class="modal fade" id="duplicateUserModal" role="dialog">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title">SESSION ENDED</h4>
                </div>
                <div class="modal-body">
                  <p>Sorry, your session has been disconnected. Another user is currently using your account.</p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-primary" onclick="cofirmationDupUser()">GOT IT</button>
                </div>
              </div>
            </div>
           </div>
  </div><!--#main-->
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js "></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.3.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.3.1/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.3.1/js/buttons.html5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" src="/web/web-commons.js"></script>
    <script src="/HASH/md5.js"></script>
    <script src="/HASH/aes.js"></script>
    <script src="/nestle/connectionString/LOCALSTORAGE/storage.js"></script>
    <script type="text/javascript" src="/js/bootbox.min.js"></script>
    <script type="text/javascript" src="/js/dynamicHeader.js"></script>
    <!-- <script src="js/chatApi.js"></script> -->
    <!-- <script type="text/javascript" src="js/duplicate-user.js"></script> -->
    <script>
    var user = localStorage.getItem("adminUserName");
	  var usernm = localStorage.getItem("username");

	//   var s = localStorage.getItem("srvr");
	//   var u = localStorage.getItem("usrnm");
	//   var p = localStorage.getItem("psswrd");
	//   var d = localStorage.getItem("dtbse");
	//   var con_info = [s, p, u, d];

    getcompname();
    function getcompname(){
      $.ajax ({
          url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php",
          type: "GET",
          data: {"type":"GET_COMPANYNAME", "CONN":con_info},
          dataType: "json",
          crossDomain: true,
          cache: false,            
            success: function(r){ 
                $('#titleHeading').html(r[0].company.toUpperCase() +' / Customer');
            },error: function(jqXHR, textStatus, errorThrown) {
                alert('ERROR CONNECTING TO SERVER:\n Please Check your connection settings.');
            }
        });
    } 

      $('.job-inpt-data-h').attr('disabled', 'disabled');
      showNotif();

      $('#navDrop').click(function() {
        $("i", this).toggleClass("glyphicon-menu-up glyphicon-menu-down");
      });
      
      $(document).on('click', '.dropdown-toggle', function(){
        $('.count').html('');
         showNotif('yes');
      });

    //   setInterval(function(){
    //    //loadPopup();
    //    showNotif();
    //  }, 9000); 

      customerData();
      customerDataTable();

      var sourceData;
      function customerData(){
        $.ajax ({
          url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php",
          type: "GET",
          data: {"type":"CUSTOMER_TAGGING_DATA", "CONN":con_info},
          dataType: "JSON",
          crossDomain: true,
          cache: false,     
          async: false,       
            success: function(r){ 
              sourceData = r;
            }
        });
      }
      var tableData;
      function customerDataTable(){
         tableData =  $('table.customerList').DataTable({
                    "dom": 'frtip',
                    "data": sourceData,
                    "scrollX": true,
                    "ordering": false,
                    "columns": [
                        { "data": "salesmanAssign"},
                        { "data": "CustomerName"},
                        { "data": "DefaultOrdType" },
                        { "data": "SoldToAddr1" },
                        { "data": "Contact"},
                        { "data": "Telephone" },
                        { "data": "CustType"}
                    ],
                    //buttons: [ 'excel', 'print', 'copy' ],
                    "language": {
                      "emptyTable": "No available records as of now."
                    },
                    // "aaSorting": [[ 0, "desc" ]],
                    rowCallback: function(row, data, index){
                      var statIndicator = $(row).find('td:eq(2)').text();
                      if(statIndicator == 'B'){ 
                        // $(row).find('td:eq(2)').text('BOOKING');
                        $(row).find('td:eq(2)').css({'color': 'white', "background-color": "#e06335", "text-align":"center"});
                      }else{
                        $(row).find('td:eq(2)').text('T');
                        $(row).find('td:eq(2)').css({'color': 'white', "background-color": "#00A86B", "text-align":"center"});
                      }
                  }
           });

        $('table.customerList tbody').on('click', 'tr', function () {
            var tr = $(this).closest('tr');
            var row = tableData.row(tr);
            exec_savetojobber(row.data());
        });

        function exec_savetojobber(r){
          var ordtype = 'BOOKING';
          if(r.DefaultOrdType != 'B'){
            ordtype = 'TRUCK';
            $('.infoFooter').html("Click 'Yes' if you want to change order type to <strong>BOOKING</strong>");
            $('#revertBtn').hide();
            $('#addJobberBtn').show();
          }else{
            $('.infoFooter').html("Click 'Yes' if you want to change order type to <strong>TRUCK</strong>");
            $('#addJobberBtn').hide();
            $('#revertBtn').show();
          }
          $('#mdCodeH').val(r.Salesperson);
          $('#custCodeH').val(r.Customer);
          $('#customerH').val(r.Name);
          $('#contactnumH').val(r.Telephone);
          $('#contactPersonH').val(r.Contact);
          $('#addressH').val(r.SoldToAddr1);
          $('#isLockH').val(r.isLockOn);
          $('#custTypeH').val(r.CustType);
          $('#latH').val(r.Latitude);
          $('#longH').val(r.Longitude);
          $('#orderTypeText').html(ordtype);
          //$('#isLockText').html(islockOnverifyer(r.isLockOn));
          $('#tojobbermodal').modal('show');
        }
      }

      function islockOnverifyer(r){
        
        if(r == 0){
          return '<strong style="color: red;">NO</strong>';
        }
         return '<strong style="color: #5ee663;">YES</strong>';
      }

      function exec_insertCustomer(){
        var r = confirm("Press 'OK' to proceed.");
        if(r){
          $('#addJobberBtn').html('<i class="fa fa-spinner fa-spin"></i> updating.. ');
          $( "#addJobberBtn").prop( "disabled", true );
          var custCode = $('#custCodeH').val();
          $.ajax ({
            url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php",
            type: "GET",
            data: {
                    "type":"UPDATE_ORDERTYPE", 
                    "CONN":con_info,
                    "custCode":custCode
                  },
            dataType: "JSON",
            crossDomain: true,
            cache: false,     
            async: false,       
              success: function(r){ 
                if(r){
                  customerData();
                  tableData.clear().rows.add(sourceData).draw();
                  alert('Customer succesfully updated!');
                }else{
                  alert('UNABLE TO INSERT: Customer is already in the jobber list!');
                }
                  $("#addJobberBtn").prop( "disabled", false );
                  $('#addJobberBtn').html('Add');
               
              },error: function(XMLHttpRequest, textStatus, errorThrown) {
                alert('ERROR CUSTOMER UPDATE: ' + JSON.stringify(XMLHttpRequest.responseText));
                $( "#addJobberBtn").prop( "disabled", false );
                $('#addJobberBtn').html('Add');
              }
          });
        }
      }

      function exec_insertCustomer_revert(){
        var r = confirm("Press 'OK' to proceed.");
        if(r){
          $('#revertBtn').html('<i class="fa fa-spinner fa-spin"></i> updating.. ');
          $( "#revertBtn").prop( "disabled", true );
          var custCode = $('#custCodeH').val();
          $.ajax ({
            url: GLOBALLINKAPI+"/nestle/connectionString/applicationipAPI.php",
            type: "GET",
            data: {
                    "type":"UPDATE_ORDERTYPE_REVERT", 
                    "CONN":con_info,
                    "custCode":custCode
                  },
            dataType: "JSON",
            crossDomain: true,
            cache: false,     
            async: false,       
              success: function(r){ 
                if(r){
                  customerData();
                  tableData.clear().rows.add(sourceData).draw();
                  alert('Customer succesfully updated!');
                }else{
                  alert('UNABLE TO INSERT: Customer is already in the jobber list!');
                }
                  $("#revertBtn").prop( "disabled", false );
                  $('#revertBtn').html('Add');
               
              },error: function(XMLHttpRequest, textStatus, errorThrown) {
                alert('ERROR CUSTOMER UPDATE: ' + JSON.stringify(XMLHttpRequest.responseText));
                $( "#revertBtn").prop( "disabled", false );
                $('#revertBtn').html('Add');
              }
          });
        }
      }

      function showNotif(view=''){
         $.ajax ({
          url: "../geofencing/GeofencingAPI.php",
          type: "GET",
          data: {"type":"view_notifications_icon_"+user, "view":view},
          dataType: "JSON",
          crossDomain: true,
          cache: false,            
            success: function(response){ 
           // console.log('Notification function has been refresh');                
            $("#notifs-icon-div").html(response.notification);
              if(response.unseen_notification > 0)
              {
               $('.count').html(response.unseen_notification);
              }
            }
        });
      }
        
    $(window).bind("load", function () {
        $('#work-in-progress').fadeOut();
    });

    function myFunction() {
        var x = document.getElementById("myTopnav");
        if (x.className === "topnav") {
            x.className += " responsive";
        } else {
            x.className = "topnav";
        }
    } 


    (function($) {
      $.fn.clickToggle = function(func1, func2) {
          var funcs = [func1, func2];
          this.data('toggleclicked', 0);
          this.click(function() {
              var data = $(this).data();
              var tc = data.toggleclicked;
              $.proxy(funcs[tc], this)();
              data.toggleclicked = (tc + 1) % 2;
          });
          return this;
      };
    }(jQuery));

     
    $("#navBtn").clickToggle(function() {   
        openNav();
      }, function() {
        closeNav();
    });
      
    function imgError2(image) {
      image.onerror = "";
      image.src = "../img/salesmanPic.jpg";
      return true;
    }  
       
    function openNav() {
        document.getElementById("mySidenav").style.width = "270px";
        document.getElementById("main").style.marginLeft = "270px";
    }

    function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
        document.getElementById("main").style.marginLeft= "0";
    }


</script>

     
</body>
</html> 

<!DOCTYPE html>
<html>
<head>
  <title>
    Jobber Customer
  </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
 <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
 
 <link rel="shortcut icon" href="/img/mdlogo_web.png" type="image/png"/>
 <link rel="stylesheet" href="/css/mdDesign.css"/>

  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.5.6/css/buttons.dataTables.min.css">
</head>
<body>

  <div id="main">
         <div class="panel cust-panel">
               <div class="panel-heading">
                   <i class="fas fa-clipboard-list"></i> <span id="titleHeading"></span>
               </div>
                <div class="panel-body" style='background-color:#fff; color: black;'>   
                  <div class="table-responsive">
                    <table class="table table-hover display nowrap customerList" style="width: 100%;">
                       <thead>
                        <tr>
                          <th>SALESMAN</th>
                          <th>CUST NAME</th>
                          <th>CONTACT PERSON</th>
                          <th>ADDRESS</th>
                          <th>CONTACT #</th>
                          <th>isLock On</th>
                          <th>CUST TYPE</th>
                        </tr>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>
                  </div>
               </div>
         </div><!--main panel end-->

         <div class="modal fade" id="tojobbermodal" role="dialog">
            <div class="modal-dialog">
              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4 class="modal-title">Add Customer as Jobber</h4>
                </div>
                <div class="modal-body">
                  <table class="table table-hover">
                    <tr>
                      <td>SALES PERSON:</td>
                      <td><input type="text" name="" id="mdCodeH" class="job-inpt-data-h"></td>
                    </tr>
                    <tr>
                      <td>CUSTOMER NAME:</td>
                      <td id=""><input type="text" name="" id="customerH" class="job-inpt-data-h"></td>
                    </tr>
                    <tr>
                      <td>MOBILE:</td>
                      <td><input type="text" name="" id="contactnumH" class="job-inpt-data-h"></td>
                    </tr>
                    <tr>
                      <td>CONTACT PERSON:</td>
                      <td id=""><input type="text" name="" id="contactPersonH" class="job-inpt-data-h"></td>
                    </tr>
                    <tr>
                      <td>ADDRESS:</td>
                      <td id=""><input type="text" name="" id="addressH" class="job-inpt-data-h"></td>
                    </tr>
                    <tr>
                      <td>CUST TYPE:</td>
                      <td id=""><input type="text" name="" id="custTypeH" class="job-inpt-data-h"></td>
                    </tr>
                    <tr>
                      <td>IS LOCK:</td>
                      <td id="isLockText"></td>
                    </tr>
                    

                  </table>
                  <input type="hidden" name="" id="latH">
                  <input type="hidden" name="" id="longH">
                  <input type="hidden" name="" id="custCodeH">
                  <input type="hidden" name="" id="isLockH">
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-primary" id="addJobberBtn" data-dismiss="modal" onclick="exec_insertCustomer()">Add</button>
                </div>
              </div>
            </div>
          </div>
  </div><!--#main-->
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js "></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.3.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.3.1/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.3.1/js/buttons.html5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" src="/web/web-commons.js"></script>
    <script type="text/javascript" src="/js/bootbox.min.js"></script>
    <script type="text/javascript" src="/js/dynamicHeader.js"></script>
    <script src="/HASH/md5.js"></script>
    <script src="/HASH/aes.js"></script>
    <script src="/nestle/connectionString/LOCALSTORAGE/storage.js"></script>
    <script>
    var user = localStorage.getItem("adminUserName");
	  var usernm = localStorage.getItem("username");


    getcompname();
    function getcompname(){
      $.ajax ({
          url: "/nestle/connectionString/applicationipAPI.php",
          type: "GET",
          data: {"type":"GET_COMPANYNAME", "CONN":con_info},
          dataType: "json",
          crossDomain: true,
          cache: false,            
            success: function(r){ 
             $('#titleHeading').html(r[0].company.toUpperCase() +' / Jobber Customer');
            }
        });
    } 

      $('.job-inpt-data-h').attr('disabled', 'disabled');
      showNotif();

      $('#navDrop').click(function() {
        $("i", this).toggleClass("glyphicon-menu-up glyphicon-menu-down");
      });
      
      $(document).on('click', '.dropdown-toggle', function(){
        $('.count').html('');
         showNotif('yes');
      });

      setInterval(function(){
       //loadPopup();
       showNotif();
     }, 9000); 

      customerData();
      customerDataTable();

      var sourceData;
      function customerData(){
        $.ajax ({
          url: "/nestle/connectionString/applicationipAPI.php",
          type: "GET",
          data: {"type":"JOBBER_MAINTENANCE_CUST_DATA", "CONN":con_info},
          dataType: "JSON",
          crossDomain: true,
          cache: false,     
          async: false,       
            success: function(r){ 
              sourceData = r;
            },
			error: function(XMLHttpRequest, textStatus, errorThrown) {
            //var botboxMsg = '<b style="color: red;">Error in fetching salesman markers:</b>' + XMLHttpRequest.responseText;
            //bootbox.alert(botboxMsg);
				alert('Error in fetching jobber customer:\n' + XMLHttpRequest.responseText);
           }
        });
      }

      function customerDataTable(){
        var tableData =  $('table.customerList').DataTable({
                    "dom": 'frtip',
                    "data": sourceData,
                    "scrollX": true,
                    "ordering": false,
                    "columns": [
                        { "data": "salesmanAssign"},
                        { "data": "CustomerName"},
                        { "data": "Contact"},
                        { "data": "SoldToAddr1" },
                        { "data": "Telephone" },
                        { "data": "isLockOn" },
                        { "data": "CustType"}
                    ],
                    //buttons: [ 'excel', 'print', 'copy' ],
                    "language": {
                      "emptyTable": "No available records as of now."
                    },
                    "aaSorting": [[ 0, "desc" ]],
                    rowCallback: function(row, data, index){
                  }
           });

        $('table.customerList tbody').on('click', 'tr', function () {
            var tr = $(this).closest('tr');
            var row = tableData.row(tr);
            exec_savetojobber(row.data());
        });

        function exec_savetojobber(r){
          $('#mdCodeH').val(r.Salesperson);
          $('#custCodeH').val(r.Customer);
          $('#customerH').val(r.Name);
          $('#contactnumH').val(r.Telephone);
          $('#contactPersonH').val(r.Contact);
          $('#addressH').val(r.SoldToAddr1);
          $('#isLockH').val(r.isLockOn);
          $('#custTypeH').val(r.CustType);
          $('#latH').val(r.Latitude);
          $('#longH').val(r.Longitude);
          $('#isLockText').html(r.isLockOn);
          //$('#isLockText').html(islockOnverifyer(r.isLockOn));
          $('#tojobbermodal').modal('show');
        }
      }

      function islockOnverifyer(r){
        
        if(r == 0){
          return '<strong style="color: red;">NO</strong>';
        }
         return '<strong style="color: #5ee663;">YES</strong>';
      }

      function exec_insertCustomer(){
        var r = confirm('Are you sure you want to add this customer as jobber?');
        if(r){
          $('#addJobberBtn').html('<i class="fa fa-spinner fa-spin"></i> adding please wait.. ');
          $( "#addJobberBtn").prop( "disabled", true );
          var custCode = $('#custCodeH').val();
          var custName = $('#customerH').val();
          var contCell = $('#contactnumH').val();
          var contPerson = $('#contactPersonH').val();
          var address = $('#addressH').val();
          var lat = checkLatLngifzero($('#latH').val());
          var long = checkLatLngifzero($('#longH').val());
          var isLockOn = $('#isLockH').val();
          var custType = $('#custTypeH').val();

           $.ajax ({
            url: "/nestle/connectionString/applicationipAPI.php",
            type: "GET",
            data: {
                    "type":"EXEC_INSERT_JOBBER_CUSTOMER", 
                    "CONN":con_info,
                    "custCode":custCode,
                    "custName": custName,
                    "contCell": contCell,
                    "contPerson": contPerson,
                    "address":address,
                    "lat":lat,
                    "long":long,
                    "isLockOn":isLockOn,
                    "custType":custType
                  },
            dataType: "JSON",
            crossDomain: true,
            cache: false,     
            async: false,       
              success: function(r){ 
                if(r != 'jobready'){
                  alert('Customer succesfully added to jobber list!');
                }else{
                  alert('UNABLE TO INSERT: Customer is already in the jobber list!');
                }
                  $( "#addJobberBtn").prop( "disabled", false );
                  $('#addJobberBtn').html('Add');
               
              }, error: function(XMLHttpRequest, textStatus, errorThrown) {
                alert('ERROR JOBBER INSERT: ' + JSON.stringify(XMLHttpRequest.responseText));
                $( "#addJobberBtn").prop( "disabled", false );
                $('#addJobberBtn').html('Add');
              }
          });
        }
      }

      function checkLatLngifzero(coor){
        var data = 0.0;
        if(coor < 0 || coor == '.000000'){
          return data;
        }
        return coor;
      }

      function showNotif(view=''){
         $.ajax ({
          url: "../geofencing/GeofencingAPI.php",
          type: "GET",
          data: {"type":"view_notifications_icon_"+user, "view":view},
          dataType: "JSON",
          crossDomain: true,
          cache: false,            
            success: function(response){ 
           // console.log('Notification function has been refresh');                
            $("#notifs-icon-div").html(response.notification);
              if(response.unseen_notification > 0)
              {
               $('.count').html(response.unseen_notification);
              }
            }
        });
      }
        
    $(window).bind("load", function () {
        $('#work-in-progress').fadeOut();
    });

    function myFunction() {
        var x = document.getElementById("myTopnav");
        if (x.className === "topnav") {
            x.className += " responsive";
        } else {
            x.className = "topnav";
        }
    } 


    (function($) {
      $.fn.clickToggle = function(func1, func2) {
          var funcs = [func1, func2];
          this.data('toggleclicked', 0);
          this.click(function() {
              var data = $(this).data();
              var tc = data.toggleclicked;
              $.proxy(funcs[tc], this)();
              data.toggleclicked = (tc + 1) % 2;
          });
          return this;
      };
    }(jQuery));

     
    $("#navBtn").clickToggle(function() {   
        openNav();
      }, function() {
        closeNav();
    });
      
    function imgError2(image) {
      image.onerror = "";
      image.src = "../img/salesmanPic.jpg";
      return true;
    }  
       
    function openNav() {
        document.getElementById("mySidenav").style.width = "270px";
        document.getElementById("main").style.marginLeft = "270px";
    }

    function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
        document.getElementById("main").style.marginLeft= "0";
    }


</script>

     
</body>
</html> 
